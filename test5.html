<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.css">
    <script src="https://cdn.jsdelivr.net/npm/handsontable/dist/handsontable.full.min.js"></script>
    <script src="https://unpkg.com/vue@next"></script>
    <title>Document</title>
</head>
<body>
    <template>
        <div class="app-container">
          <HotTable ref="hotTableComponent" :settings="hotSettings"/>
        </div>
      </template>
      
      <script>
    //   import Handsontable from 'handsontable'
    //   import {HotTable} from '@handsontable/vue'
    //   import 'handsontable/languages' // 语言设置
      
      var cm = {
        name: "simpleTable",
        data() {
          return {
            hotSettings: {
              language: 'zh-CN', // 语言设置
              licenseKey: 'non-commercial-and-evaluation', // 隐藏版权文字
              width: 'auto', // 表格宽度
              height: 'auto', // 表格高度、设置以后才会出现scroll
              // data: Handsontable.helper.createSpreadsheetData(10, 26), // 列表初始化数据
              data: [], // 表格数据也可根据实际项目需要进行设置
              // startRows: 1, // 初始化行数,无data属性时生效(该值小于minRows时,以minRows为准)
              // startCols: 3, // 初始化列数,无data属性时生效(该值小于minCols时,以minCols为准)
              // minRows: 1, // 最少行数(当初始化数据小于该值时,以该值为准)
              // minCols: 3, // 最少列数(当初始化数据小于该值时,以该值为准)
              minSpareCols: 0, // 列的最小留白数
              minSpareRows: 0, // 行的最小留白数
              colHeaders: true, // 是否展示列表头,默认是A,B,C等字母,可以['列1','列2']进行自定义展示
              // colHeaders: ['V', 'Ti（NTM）', 'Ti（ETM）'],// 自定义表格的表头
              rowHeaders: true, // 是否展示行表头,默认是1,2,3等数据,可以['行1','行2']进行自定义展示
              colWidths: [130, 50, 70, 50, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 180, 180], // 列宽度
              rowHeights: [10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 100],
              dropdownMenu: false,// 表头展示下拉菜单,可以自定义展示
              className: ['htCenter', 'htMiddle'], // 单元格文字对齐方式(htLeft,htRight,htCenter)
              currentRowClassName: 'my-selectRow', // 给选中行添加自定义class类名
              currentColClassName: 'my-selectCol', // 给选中列添加自定义class类名
              autoWrapRow: true, // 文字是否自动换行(当没有设置colWidths时生效)
              // fixedRowsTop: 2, // 列表内容从上面开始,固定定位的行数(不包含行表头)
              // fixedColumnsLeft: 4, // 列表内容从左面开始,固定定位的列数(不包含列表头)
              fillHandle: true, // 是否开启拖拽复制操作(true,false,'horizontal'水平复制,'vertical'垂直复制)
              contextMenu: {
                // 单元格右击展示菜单
                items: {
                  row_above: {
                    name: '上面插入一行'
                  },
                  row_below: {
                    name: '下面插入一行'
                  },
                  col_left: {
                    name: '左侧插入一列'
                  },
                  col_right: {
                    name: '右侧插入一列'
                  },
                  about: { // Own custom option
                    name() { // `name` can be a string or a function
                      return '<div>自定义操作</div>'; // Name can contain HTML
                    },
                    hidden() { // `hidden` can be a boolean or a function
                      // Hide the option when the first column was clicked
                      return this.getSelectedLast()[1] === 0; // `this` === hot
                    },
                    callback(key, selection, clickEvent) { // Callback for specific option
                      console.log("key=====>", key)
                      console.log("selection=====>", selection)
                      console.log("clickEvent=====>", clickEvent)
                      setTimeout(() => {
                        alert('Hello world!'); // Fire alert after menu close (with timeout)
                      }, 0);
                    }
                  },
                  remove_row: {
                    name: '移除本行'
                  },
                  remove_col: {
                    name: '移除本列'
                  },
                  alignment: {
                    name: '对齐方式'
                  },
                  make_read_only: {
                    name: '只读'
                  },
                  borders: {
                    name: '边框'
                  },
                  copy: {
                    name: '复制'
                  },
                  cut: {
                    name: '剪切'
                  },
                  separator: Handsontable.plugins.ContextMenu.SEPARATOR,
                  clear_custom: {
                    name: '清空所有单元格数据',
                    callback: function () {
                      this.clear()
                    }
                  }
                }
              },
              mergeCells: [],
              readOnly: true,
              manualColumnResize: true,
              manualRowResize: true,
              preventOverflow: 'vertical', //防止水平溢出表
              cell: [],
              cells: function (row, col, prop) { // 单元格渲染
                let cellProperties = {
                  className: []
                }
                cellProperties.className.push("htMiddle")
                if (row >= 0 && row <= 2){
                  cellProperties.className.push("blueClassName")
                }
                if ((row >= 7 && row <= 8 && col >= 4 && col <= 15) ||
                    (row >= 10 && row <= 11 && col >= 4 && col <= 15) ||
                    (row === 3 && col >= 17)){
                  cellProperties.className.push("skyBlueClassName")
                }
                if (row >= 3 && row <= 10 && col >= 4 && col <= 16){
                  cellProperties.className.push("htRight")
                }
                if ((row === 3 && (col === 17 || col === 18)) || (row === 11 && col >= 4 && col <= 15)){
                  cellProperties.readOnly = false
                }
                return cellProperties;
              },
              afterSetCellMeta(row, col, key, val) {
                console.log('afterSetCellMeta====>', row, col, key, val);
              },
            },
          }
        },
        components: {
          HotTable
        },
        created() {
          this.hotSettings.data = this.getSalePlan()
          this.hotSettings.mergeCells = this.getMergeCells()
        },
        methods: {
          clickBtn() {
            console.log(this.hotSettings);
          },
          // 获取合并配置信息
          getMergeCells() {
            let mergeCellsConf = [
              {row: 0, col: 0, rowspan: 3, colspan: 1},
              {row: 0, col: 1, rowspan: 3, colspan: 2},
              {row: 0, col: 3, rowspan: 3, colspan: 1},
              {row: 0, col: 4, rowspan: 1, colspan: 12},
              {row: 0, col: 16, rowspan: 3, colspan: 1},
              {row: 0, col: 17, rowspan: 3, colspan: 1},
              {row: 0, col: 18, rowspan: 3, colspan: 1},
              {row: 3, col: 0, rowspan: 8, colspan: 1},
              {row: 3, col: 1, rowspan: 4, colspan: 1},
              {row: 7, col: 1, rowspan: 4, colspan: 1},
              {row: 3, col: 17, rowspan: 8, colspan: 1},
              {row: 3, col: 18, rowspan: 8, colspan: 1},
              {row: 11, col: 0, rowspan: 1, colspan: 3},
            ]
      
            return mergeCellsConf;
          },
          // 获取表格数据信息
          getSalePlan() {
            // 模拟从后端获取....
            let salePlanData = [
              ["店铺名称", "类别", "", "序号", "2021", "", "", "", "", "", "", "", "", "", "", "", "合计", "原因分析", "基本对策"],
              ["", "", "", "", "01月", "02月", "03月", "04月", "05月", "06月", "07月", "08月", "09月", "10月", "11月", "12月", "", "", ""],
              ["", "", "", "", "元旦", "春节,情人节,元宵节", "妇女节,植树节", "", "劳动节,青年节", "端午,儿童节", "周年庆", "七夕", "教师节,中秋", "国庆,重阳", "双十一", "圣诞节", "", "", ""],
              ["北京东山百货", "实绩", "成交客数", "1", "153.00", "12.00", "28.00", "45.00", "352.00", "291.00", "403.00", "315.00", "439.00", "303.00", "173.00", "386.00", "2900.00"],
              ["", "", "客单(元)", "2", "619.07", "272.61", "553.41", "532.33", "314.80", "277.35", "363.27", "362.00", "280.09", "429.54", "540.12", "638.33", "407.70"],
              ["", "", "金额(万元)", "3", "9.47", "0.33", "1.55", "2.40", "11.08", "8.07", "14.64", "11.40", "12.30", "13.01", "9.34", "24.64", "118.23"],
              ["", "", "连单数(件)", "4", "1.82", "0.67", "2.00", "1.78", "2.14", "1.97", "2.02", "1.96", "1.91", "1.99", "2.02", "2.04", "1.86"],
              ["", "计划", "成交客数", "5", "160.00", "80.00", "80.00", "100.00", "350.00", "290.00", "410.00", "320.00", "440.00", "300.00", "170.00", "390.00", "3090.00"],
              ["", "", "客单(元)", "6", "620.00", "280.00", "560.00", "540.00", "320.00", "280.00", "360.00", "360.00", "280.00", "430.00", "500.00", "600.00", "403.75"],
              ["", "", "金额(万元)", "7", "9.92", "2.24", "4.48", "5.40", "11.20", "8.12", "14.76", "11.52", "12.32", "12.90", "8.50", "23.40", "124.76"],
              ["", "", "连单数(件)", "8", "1.85", "1.00", "1.60", "1.80", "1.80", "1.50", "1.80", "1.80", "1.50", "1.80", "2.00", "2.00", "1.7"],
              ["工作计划", "", "", "9", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
            ];
            // TODO 后端数据处理
            return salePlanData;
          }
      
        }
      }
      </script>
      
      <!-- <style lang="less">
      .handsontable {
        /* .blueClassName{
          background-color: #2497d0;
          color: #fff !important;
        } */
        .skyBlueClassName {
          background: #cbfdfd;
        }
      }
      </style> -->
</body>
</html>